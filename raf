import React, { useState } from "react";
import { toast } from "react-toastify";
import axios from "axios";
import {
  Grid,
  TextField,
  Button,
  Select,
  MenuItem,
  FormControl,
  InputLabel,
} from "@mui/material";
import SelectInputFromData from "@/components/inputs/SelectInputCourse";

const CreateClassForm = ({
  teachers,
  courses,
  faculties,
  setData,
  setModelOpen,
}) => {
  const [classData, setClassData] = useState({
    name: "",
    code: "",
    description: "",
    faculty: faculties[0]?.faculty,
    credits: "",
    section: "",
    course: "",
    teacher: "",
    startDate: "",
    endDate: "",
    batch: "",
    schedule: [],
  });

  const handleDayOfWeekSelect = (selectedDayOfWeek, index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule[index] = {
        ...updatedSchedule[index],
        dayOfWeek: selectedDayOfWeek,
      };
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleStartTimeChange = (startTime, index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule[index] = {
        ...updatedSchedule[index],
        startTime,
      };
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleEndTimeChange = (endTime, index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule[index] = {
        ...updatedSchedule[index],
        endTime,
      };
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleAddSchedule = () => {
    setClassData((prevData) => ({
      ...prevData,
      schedule: [
        ...prevData.schedule,
        { dayOfWeek: "", startTime: "", endTime: "" },
      ],
    }));
  };

  const handleRemoveSchedule = (index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule.splice(index, 1);
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleCourseSelect = (selectedCourse) => {
    setClassData((prevData) => ({ ...prevData, course: selectedCourse }));
  };

  const handleTeacherSelect = (selectedTeacher) => {
    setClassData((prevData) => ({ ...prevData, teacher: selectedTeacher }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    try {
      const { data } = await axios.post(
        "http://localhost:3000/api/subadmin/createclass",
        classData
      );

      setData(Array.isArray(data.class) ? data.class : []);
      setClassData({
        name: "",
        code: "",
        description: "",
        faculty: faculties[0]?.faculty,
        credits: "",
        section: "",
        course: "",
        teacher: "",
        startDate: "",
        endDate: "",
        batch: "",
        schedule: [],
      });
      setModelOpen(false);
      toast.success(data.message);
    } catch (error) {
      toast.error(error?.response.data.message);
    }
  };

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <div className="px-4 py-5 bg-white sm:p-6">
          <h2 className="text-2xlmb-6 font-semibold tracking-tight text-gray-900sm:text-3xl">
            Create Class
          </h2>
          <Grid container spacing={3}>
            <Grid item xs={12} sm={6}>
              <SelectInputFromData
                itemName={"Course"}
                setname={setName}
                data={courses}
                onSelect={handleCourseSelect}
              />
            </Grid>
            <Grid item xs={12} sm={6}>
              <TextField
                id="description"
                label="Description"
                variant="outlined"
                value={classData.description}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    description: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={6}>
              <SelectInputFromData
                itemName={"Add Teacher"}
                data={teachers}
                onSelect={handleTeacherSelect}
              />
            </Grid>
            <Grid item xs={12} sm={6}>
              <FormControl variant="outlined" fullWidth>
                <InputLabel htmlFor="faculty">Faculty</InputLabel>
                <Select
                  id="faculty"
                  value={classData.faculty}
                  onChange={(e) =>
                    setClassData({
                      ...classData,
                      faculty: e.target.value,
                    })
                  }
                  label="Faculty"
                >
                  {faculties?.map((item, id) => (
                    <MenuItem key={id} value={item.faculty}>
                      {item.faculty}
                    </MenuItem>
                  ))}
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} sm={6}>
              <TextField
                id="batch"
                label="Batch"
                variant="outlined"
                value={classData.batch}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    batch: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="class-name"
                label="Class name"
                variant="outlined"
                value={classData.name}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    name: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="class-code"
                label="Class Code"
                variant="outlined"
                value={classData.code}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    code: e.target.value.toLocaleUpperCase(),
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="credits"
                label="Credits"
                variant="outlined"
                value={classData.credits}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    credits: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="section"
                label="Section"
                variant="outlined"
                value={classData.section}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    section: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="start-date"
                label="Starting Date"
                type="date"
                variant="outlined"
                InputLabelProps={{ shrink: true }}
                value={classData.startDate}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    startDate: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="end-date"
                label="Ending Date"
                InputLabelProps={{ shrink: true }}
                type="date"
                variant="outlined"
                value={classData.endDate}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    endDate: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
          </Grid>
          <Grid container spacing={3}>
            {classData.schedule.map((item, index) => (
              <React.Fragment key={index}>
                <Grid item xs={12} sm={4}>
                  <FormControl variant="outlined" fullWidth>
                    <InputLabel htmlFor={`dayOfWeek-${index}`}>
                      Day of Week
                    </InputLabel>
                    <Select
                      id={`dayOfWeek-${index}`}
                      value={item.dayOfWeek}
                      onChange={(e) =>
                        handleDayOfWeekSelect(e.target.value, index)
                      }
                      label="Day of Week"
                    >
                      {/* Add options for day of week */}
                    </Select>
                  </FormControl>
                </Grid>
                <Grid item xs={12} sm={4}>
                  <TextField
                    id={`startTime-${index}`}
                    label="Start Time"
                    type="time"
                    InputLabelProps={{ shrink: true }}
                    variant="outlined"
                    value={item.startTime}
                    onChange={(e) =>
                      handleStartTimeChange(e.target.value, index)
                    }
                    fullWidth
                  />
                </Grid>
                <Grid item xs={12} sm={3}>
                  <TextField
                    id={`endTime-${index}`}
                    label="End Time"
                    type="time"
                    variant="outlined"
                    value={item.endTime}
                    onChange={(e) => handleEndTimeChange(e.target.value, index)}
                    fullWidth
                  />
                </Grid>
                <Grid item xs={12} sm={1}>
                  <Button
                    variant="outlined"
                    color="secondary"
                    onClick={() => handleRemoveSchedule(index)}
                  >
                    Remove
                  </Button>
                </Grid>
              </React.Fragment>
            ))}
            <Grid item xs={12}>
              <Button
                variant="outlined"
                color="primary"
                onClick={handleAddSchedule}
              >
                Add Schedule
              </Button>
            </Grid>
          </Grid>

          <div className="mt-6">
            <Button type="submit" variant="contained" color="primary">
              Create
            </Button>
          </div>
        </div>
      </form>
    </div>
  );
};

export default CreateClassForm;






//////////////////////////////////////




import React, { useState } from "react";
import { toast } from "react-toastify";
import axios from "axios";
import {
  Grid,
  TextField,
  Button,
  Select,
  MenuItem,
  FormControl,
  InputLabel,
} from "@mui/material";
import SelectInputFromData from "@/components/inputs/SelectInputCourse";

const CreateClassForm = ({
  teachers,
  courses,
  faculties,

  batches,
  setData,
  setModelOpen,
}) => {
  const [selectedTeacher, setSelectedTeacher] = useState({ id: "", name: "" });
  const [selectedBatch, setSelectedBatch] = useState({ id: "", name: "" });

  const [classData, setClassData] = useState({
    name: "",
    code: "",
    description: "",
    faculty: faculties[0]?.faculty,
    credits: "",
    section: "",
    course: courses[0]?.id,

    startDate: "",
    endDate: "",

    schedule: [],
  });

  console.log(classData, selectedBatch);
  const handleDayOfWeekSelect = (selectedDayOfWeek, index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule[index] = {
        ...updatedSchedule[index],
        dayOfWeek: selectedDayOfWeek,
      };
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleStartTimeChange = (startTime, index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule[index] = {
        ...updatedSchedule[index],
        startTime,
      };
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleEndTimeChange = (endTime, index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule[index] = {
        ...updatedSchedule[index],
        endTime,
      };
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleAddSchedule = () => {
    setClassData((prevData) => ({
      ...prevData,
      schedule: [
        ...prevData.schedule,
        { dayOfWeek: "", startTime: "", endTime: "" },
      ],
    }));
  };

  const handleRemoveSchedule = (index) => {
    setClassData((prevData) => {
      const updatedSchedule = [...prevData.schedule];
      updatedSchedule.splice(index, 1);
      return { ...prevData, schedule: updatedSchedule };
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    try {
      const { data } = await axios.post(
        "http://localhost:3000/api/subadmin/createclass",
        classData
      );

      setData(Array.isArray(data.class) ? data.class : []);
      setClassData({
        name: "",
        code: "",
        description: "",
        faculty: faculties[0]?.faculty,
        credits: "",
        section: "",
        course: "",
        teacher: "",
        startDate: "",
        endDate: "",
        batch: "",
        schedule: [],
      });
      setModelOpen(false);
      toast.success(data.message);
    } catch (error) {
      toast.error(error?.response.data.message);
    }
  };

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <div className="px-4 py-5 bg-white sm:p-6">
          <h2 className="text-2xlmb-6 font-semibold tracking-tight text-gray-900sm:text-3xl">
            Create Class
          </h2>
          <Grid container spacing={3}>
            <Grid item xs={12} sm={6}>
              <FormControl variant="outlined" fullWidth>
                <InputLabel htmlFor="course">Course</InputLabel>
                <Select
                  id="course"
                  value={classData.course ?? ""}
                  onChange={(e) =>
                    setClassData({
                      ...classData,
                      course: e.target.value,
                    })
                  }
                  label="Course"
                >
                  {courses?.map((item, id) => (
                    <MenuItem key={id} value={item.name}>
                      {item.name}
                    </MenuItem>
                  ))}
                </Select>
              </FormControl>
            </Grid>

            <Grid item xs={12} sm={6}>
              <TextField
                id="description"
                label="Description"
                variant="outlined"
                value={classData.description}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    description: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={6}>
              <FormControl variant="outlined" fullWidth>
                <InputLabel htmlFor="teacher">Add Teacher</InputLabel>
                <Select
                  id="teacher"
                  value={selectedTeacher.id}
                  onChange={(e) => {
                    const selectedTeacherId = e.target.value;
                    const selectedTeacherData = teachers.find(
                      (teacher) => teacher._id === selectedTeacherId
                    );
                    setSelectedTeacher({
                      id: selectedTeacherId,
                      name: selectedTeacherData ? selectedTeacherData.name : "",
                    });
                  }}
                  label="Add Teacher"
                >
                  {teachers?.map((item) => (
                    <MenuItem key={item._id} value={item._id}>
                      {item.name}
                    </MenuItem>
                  ))}
                </Select>
              </FormControl>
            </Grid>

            <Grid item xs={12} sm={6}>
              <FormControl variant="outlined" fullWidth>
                <InputLabel htmlFor="faculty">Faculty</InputLabel>
                <Select
                  id="faculty"
                  value={classData.faculty ?? " "}
                  onChange={(e) =>
                    setClassData({
                      ...classData,
                      faculty: e.target.value,
                    })
                  }
                  label="Faculty"
                >
                  {faculties?.map((item, id) => (
                    <MenuItem key={id} value={item.faculty}>
                      {item.faculty}
                    </MenuItem>
                  ))}
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} sm={6}>
              <FormControl variant="outlined" fullWidth>
                <InputLabel htmlFor="batch">Batch</InputLabel>
                <Select
                  id="batch"
                  value={selectedBatch.id}
                  onChange={(e) => {
                    const selectedBatchId = e.target.value;
                    const selectedBatchData = batches.find(
                      (teacher) => teacher._id === selectedBatchId
                    );
                    setSelectedBatch({
                      id: selectedBatchId,
                      name: selectedBatchData
                        ? selectedBatchData.batchName
                        : "",
                    });
                  }}
                  label="Batch"
                >
                  {batches?.map((item) => (
                    <MenuItem key={item._id} value={item._id}>
                      {item.batchName}
                    </MenuItem>
                  ))}
                </Select>
              </FormControl>
            </Grid>
            {/* <Grid item xs={12} sm={6}>
              <TextField
                id="batch"
                label="Batch"
                variant="outlined"
                value={classData.batch}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    batch: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid> */}
            <Grid item xs={12} sm={3}>
              <TextField
                id="class-name"
                label="Class name"
                variant="outlined"
                value={classData.name}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    name: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="class-code"
                label="Class Code"
                variant="outlined"
                value={classData.code}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    code: e.target.value.toLocaleUpperCase(),
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="credits"
                label="Credits"
                variant="outlined"
                value={classData.credits}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    credits: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="section"
                label="Section"
                variant="outlined"
                value={classData.section}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    section: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="start-date"
                label="Starting Date"
                type="date"
                variant="outlined"
                InputLabelProps={{ shrink: true }}
                value={classData.startDate}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    startDate: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
            <Grid item xs={12} sm={3}>
              <TextField
                id="end-date"
                label="Ending Date"
                InputLabelProps={{ shrink: true }}
                type="date"
                variant="outlined"
                value={classData.endDate}
                onChange={(e) =>
                  setClassData({
                    ...classData,
                    endDate: e.target.value,
                  })
                }
                fullWidth
              />
            </Grid>
          </Grid>
          <Grid container spacing={3}>
            {classData.schedule.map((item, index) => (
              <React.Fragment key={index}>
                <Grid item xs={12} sm={4}>
                  <FormControl variant="outlined" fullWidth>
                    <InputLabel htmlFor={`dayOfWeek-${index}`}>
                      Day of Week
                    </InputLabel>
                    <Select
                      id={`dayOfWeek-${index}`}
                      value={item.dayOfWeek}
                      onChange={(e) =>
                        handleDayOfWeekSelect(e.target.value, index)
                      }
                      label="Day of Week"
                    >
                      <MenuItem value={1}>Monday</MenuItem>
                      <MenuItem value={2}>Tuesday</MenuItem>
                      <MenuItem value={3}>Wednesday</MenuItem>
                      <MenuItem value={4}>Thursday</MenuItem>
                      <MenuItem value={5}>Friday</MenuItem>
                      <MenuItem value={6}>Saturday</MenuItem>
                      <MenuItem value={7}>Sunday</MenuItem>
                    </Select>
                  </FormControl>
                </Grid>

                <Grid item xs={12} sm={4}>
                  <TextField
                    id={`startTime-${index}`}
                    label="Start Time"
                    type="time"
                    InputLabelProps={{ shrink: true }}
                    variant="outlined"
                    value={item.startTime}
                    onChange={(e) =>
                      handleStartTimeChange(e.target.value, index)
                    }
                    fullWidth
                  />
                </Grid>
                <Grid item xs={12} sm={3}>
                  <TextField
                    id={`endTime-${index}`}
                    label="End Time"
                    type="time"
                    variant="outlined"
                    value={item.endTime}
                    onChange={(e) => handleEndTimeChange(e.target.value, index)}
                    fullWidth
                  />
                </Grid>
                <Grid item xs={12} sm={1}>
                  <Button
                    variant="outlined"
                    color="secondary"
                    onClick={() => handleRemoveSchedule(index)}
                  >
                    Remove
                  </Button>
                </Grid>
              </React.Fragment>
            ))}
            <Grid item xs={12}>
              <Button
                variant="outlined"
                color="primary"
                onClick={handleAddSchedule}
              >
                Add Schedule
              </Button>
            </Grid>
          </Grid>

          <div className="mt-6">
            <Button type="submit" variant="contained" color="primary">
              Create
            </Button>
          </div>
        </div>
      </form>
    </div>
  );
};

export default CreateClassForm;
